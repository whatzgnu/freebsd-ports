From 82c0f060628c5d955e6a36b3579cc81086132092 Mon Sep 17 00:00:00 2001
From: Dirk Lemstra <dirk@git.imagemagick.org>
Date: Wed, 3 May 2017 23:59:00 +0200
Subject: [PATCH] Added extra check that was reported in #466.

---
 coders/icon.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/coders/icon.c b/coders/icon.c
index 075d569de1..031f9de14e 100644
--- coders/icon.c
+++ coders/icon.c
@@ -438,7 +438,7 @@ static Image *ReadICONImage(const ImageInfo *image_info,
         {
           image->storage_class=PseudoClass;
           image->colors=icon_info.number_colors;
-          if (image->colors == 0)
+          if ((image->colors == 0) || (image->colors > 256))
             image->colors=one << icon_info.bits_per_pixel;
         }
       if (image->storage_class == PseudoClass)
