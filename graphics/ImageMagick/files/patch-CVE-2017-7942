From fd84a5e8028778fd88772775361a2ee2b4bb6c47 Mon Sep 17 00:00:00 2001
From: Dirk Lemstra <dirk@git.imagemagick.org>
Date: Mon, 17 Apr 2017 18:52:51 +0200
Subject: [PATCH] Fixed memory leak reported in #429

---
 coders/avs.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/coders/avs.c b/coders/avs.c
index a368732ff7..50cf05f18a 100644
--- coders/avs.c
+++ coders/avs.c
@@ -178,7 +178,10 @@ static Image *ReadAVSImage(const ImageInfo *image_info,ExceptionInfo *exception)
     {
       count=ReadBlob(image,length,pixels);
       if (count != length)
-        ThrowReaderException(CorruptImageError,"UnableToReadImageData");
+        {
+          pixel_info=RelinquishVirtualMemory(pixel_info);
+          ThrowReaderException(CorruptImageError,"UnableToReadImageData");
+        }
       p=pixels;
       q=QueueAuthenticPixels(image,0,y,image->columns,1,exception);
       if (q == (PixelPacket *) NULL)
