From 3358f060fc182551822576b2c0a8850faab5d543 Mon Sep 17 00:00:00 2001
From: Dirk Lemstra <dirk@git.imagemagick.org>
Date: Thu, 9 Feb 2017 21:53:23 +0100
Subject: [PATCH] Fixed memory leak when creating nested exceptions in
 Magick++.

 2017-02-09  6.9.7-8 Dirk Lemstra <dirk@lem.....org>
   * Fixed memory leak when creating nested exceptions in Magick++ (reference
     https://www.imagemagick.org/discourse-server/viewtopic.php?f=23&p=142634)

diff --git a/Magick++/lib/Exception.cpp b/Magick++/lib/Exception.cpp
index 92ca629707..8ef34bc0a0 100644
--- Magick++/lib/Exception.cpp
+++ Magick++/lib/Exception.cpp
@@ -852,12 +852,18 @@ MagickPPExport void Magick::throwException(ExceptionInfo *exception_,
             exception_->description) != 0))
           {
             if (nestedException == (Exception *) NULL)
-              nestedException=createException(p);
+              {
+                nestedException=createException(p);
+                q=nestedException;
+              }
             else
               {
-                q=createException(p);
-                nestedException->nested(q);
-                nestedException=q;
+                Exception
+                  *r;
+
+                r=createException(p);
+                q->nested(r);
+                q=r;
               }
           }
       }
